<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirection vers l'application...</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 400px;
            margin: 20px;
        }

        .icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 20px;
            border-radius: 50%;
            background: #8b5cf6;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s ease-in-out infinite;
        }

        .icon svg {
            width: 32px;
            height: 32px;
            stroke: white;
            stroke-width: 2;
            fill: none;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.05);
                opacity: 0.8;
            }
        }

        h1 {
            color: #1f2937;
            font-size: 24px;
            margin: 0 0 12px;
            font-weight: 600;
        }

        p {
            color: #6b7280;
            font-size: 16px;
            margin: 0 0 24px;
            line-height: 1.5;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(139, 92, 246, 0.2);
            border-top: 3px solid #8b5cf6;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .manual-link {
            display: inline-block;
            background: #8b5cf6;
            color: white;
            text-decoration: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.2s;
            margin-top: 8px;
        }

        .manual-link:hover {
            background: #7c3aed;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        .debug-info {
            margin-top: 24px;
            padding: 16px;
            background: #f3f4f6;
            border-radius: 8px;
            font-size: 12px;
            color: #6b7280;
            text-align: left;
            word-break: break-all;
        }

        .debug-info strong {
            color: #1f2937;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        </div>

        <h1>Traitement du paiement</h1>
        <p>Vous allez √™tre redirig√© vers l'application eBooks...</p>

        <div class="spinner"></div>

        <a href="#" id="manual-link" class="manual-link" style="display: none;">
            Ouvrir l'application manuellement
        </a>

        <div class="debug-info" id="debug-info" style="display: none;">
            <strong>Informations de debug :</strong><br>
            <span id="debug-content"></span>
        </div>
    </div>

    <script>
        console.log('üîó Payment callback page loaded');
        console.log('üìç Full URL:', window.location.href);

        // R√©cup√®re TOUS les param√®tres de l'URL (token, status, etc.)
        const urlParams = new URLSearchParams(window.location.search);
        const allParams = {};

        // Construire un objet avec tous les param√®tres
        urlParams.forEach((value, key) => {
            allParams[key] = value;
            console.log(`üìä Param: ${key} = ${value}`);
        });

        // Construire l'URL de deep link avec TOUS les param√®tres
        const deepLinkParams = new URLSearchParams(allParams);
        const deepLinkUrl = `ebooks://payment-callback?${deepLinkParams.toString()}`;

        console.log('üîó Deep link URL:', deepLinkUrl);

        // Afficher les infos de debug (utile pour le d√©veloppement)
        const debugContent = document.getElementById('debug-content');
        const debugInfo = document.getElementById('debug-info');

        if (Object.keys(allParams).length > 0) {
            debugContent.innerHTML = `
                URL compl√®te: ${window.location.href}<br>
                Param√®tres: ${JSON.stringify(allParams, null, 2).replace(/\n/g, '<br>')}
            `;
            // debugInfo.style.display = 'block'; // D√©commenter pour voir les infos en dev
        }

        // Lien manuel de secours
        const manualLink = document.getElementById('manual-link');
        manualLink.href = deepLinkUrl;

        // Fonction de redirection automatique
        function attemptRedirect() {
            try {
                console.log('üöÄ Attempting automatic redirect...');
                window.location.href = deepLinkUrl;

                // Apr√®s 2 secondes, afficher le lien manuel au cas o√π
                setTimeout(() => {
                    console.log('‚è±Ô∏è Showing manual link as fallback');
                    manualLink.style.display = 'inline-block';
                    document.querySelector('p').textContent =
                        'La redirection automatique a √©chou√©. Cliquez sur le bouton ci-dessous :';
                }, 2000);
            } catch (error) {
                console.error('‚ùå Redirect error:', error);
                manualLink.style.display = 'inline-block';
            }
        }

        // D√©marrer la redirection imm√©diatement
        attemptRedirect();

        // Log pour le debugging
        console.log('‚úÖ Redirect page initialized');
        console.log('üì± User Agent:', navigator.userAgent);
        console.log('üîó Redirect URL:', deepLinkUrl);
    </script>
</body>
</html>
